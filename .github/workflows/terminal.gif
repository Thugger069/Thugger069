name: CyberTerminal Animator

on:
  schedule:
    - cron: '0 12 * * *'  # Daily at noon UTC
  workflow_dispatch:
  push:
    paths:
      - 'config/terminalizer.yml'
      - 'scripts/**'

env:
  TERMINAL_FILE: "assets/terminal.gif"

jobs:
  generate-terminal:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Environment
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            xvfb \
            imagemagick \
            figlet \
            lolcat \
            neofetch \
            fonts-firacode

      - name: Install Dependencies
        run: |
          npm install -g terminalizer
          pip install lolcat

      - name: Generate Background
        run: |
          convert -size 800x600 xc:black -fill '#0a0a12' \
          -draw 'rectangle 0,0,800,600' assets/cyber-bg.png

      - name: Run Terminal Recording
        uses: GabrielBB/xvfb-action@v1
        with:
          run: |
            terminalizer record --config config/terminalizer.yml \
            --script ./terminal-script.json --command "bash ./scripts/terminal_demo.sh"
            terminalizer render ./terminal-script.json -o $TERMINAL_FILE
            gifsicle --optimize=3 --colors 128 -o $TERMINAL_FILE $TERMINAL_FILE

      - name: Deploy Animation
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: main
          folder: assets
          clean: true

      - name: Update README
        run: |
          bash scripts/generate_readme.sh
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add README.md
          git commit -m "ðŸ“„ Automated README update"
          git push
